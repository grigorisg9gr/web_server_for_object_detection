//for cluster version
//var BASE_URL = ;
var request = new XMLHttpRequest();
var response;
//var myDropzone = new Dropzone("#dropZone", { url: "/"});
onload = function loading() {
    ;//document.getElementById("submit").onclick = sendFile;
};

function sendFile() {
	document.getElementById("resultIm").innerHTML = "";
	//alert("Yeah, you are arnaki!");
    	//document.getElementById("status").innerHTML = "";
    	//console.info(myDropzone.element);
    	var file = document.getElementById("filechooser").files[0];
   	var extension = file.name.split(".").pop();
    	var category = document.getElementById("cat").value;console.info(category);
    	var type;
    	if (extension === "jpg" || extension === "jpeg" ||
       	      extension === "JPG" || extension === "JPEG") {
  	      type = "image/jpeg";
   	 } else if (extension === "png" || extension === "PNG") {
   	     type = "image/png";
   	 } else {
   	     //document.getElementById("status").innerHTML = "Invalid file type";
   	     return;
    	}

	document.getElementById("resultIm").innerHTML = "<img src='http://83.212.116.130:8080/fileserver/icons/tumblr_mpfqbgafiB1rzy733o1_500.gif' />";
	var formdata = new FormData();
	formdata.append("description", type); 
	formdata.append("file", file);
	formdata.append("category", category);
	//makeRequest(request, "http://83.212.116.130:8080/FileServer/resources/images", 'multipart/form-data',formdata);  
	request.open("POST", "http://83.212.116.130:8080/fileserver/resources/images", true);
	request.send(formdata);
   	 
//console.info(document.getElementById("humanRec").value);
 	//if (document.getElementById("humanRec").value=="9"){
	alert("Pom pon!")
	//makeRequest(request, "http://83.212.116.130:8080/FileServer/resources/images", type,file);
	request.onreadystatechange = printOutMessage;
}

function printOutMessage(){ 
	
	//console.info(request.readyState);
        if (request.readyState == 4){
		if ((request.status>=200)&&(request.status<300)){

			response=request.responseText;console.info(response.responseText);
			setTimeout(function(){var ref='http://83.212.116.130:8080/fileserver/uploads/'+response;
					document.getElementById('messageForResult').innerHTML ="<a href="+ref+" >Resulting Image </a>";},(6000));

		}
        } 
    }
//make the actual request
function makeRequest(temprequest, link, type,data){
	temprequest.open("POST", link, true);
    	temprequest.setRequestHeader("Content-Type", type);
    	temprequest.setRequestHeader('X-PINGOTHER', 'pingpong');
    	temprequest.withCredentials = "true"; 
	temprequest.send(data);
}




//for google analytics
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-43283906-1', '83.212.116.130:8080');
  ga('send', 'pageview');


